## User mode, kernel mode, and system calls

##### 엄격한 격리와 경계의 필요성

시스템 호출을 사용하는 소프트웨어와 시스템 호출을 구현하는 소프트웨어 사이에 강력한 격리를 제공하려면 애플리케이션과 운영 체제 사이에 엄격한 경계가 필요합니다. 애플리케이션이 실수를 하면 운영 체제가 실패하는 것을 원하지 않습니다. 대신 운영 체제에서 응용 프로그램을 정리하고 다른 응용 프로그램을 계속 실행할 수 있어야 합니다. 이 강력한 격리는 응용 프로그램이 운영 체제에서 유지 관리하는 데이터 구조를 덮어쓸 수 없어야 하고 운영 체제의 명령을 덮어쓸 수 없어야 함을 의미합니다.

##### 프로세서 실행 모드 : 커널 모드와 사용자 모드

이러한 강력한 격리 프로세서를 제공하기 위해 하드웨어 지원을 제공합니다. 예를 들어, 다른 많은 프로세서와 마찬가지로 x86 프로세서에는 프로세서가 명령을 실행하는 두 가지 모드, 즉 커널 모드와 사용자 모드가 있습니다.

*  커널 모드에서 프로세서는 권한 있는 명령을 실행할 수 있습니다. 예를 들어 디스크(또는 다른 I/O 장치)에 대한 읽기 및 쓰기는 권한 있는 명령입니다. 
* 사용자 모드의 응용 프로그램이 권한 있는 명령을 실행하려고 시도하면 프로세서는 명령을 실행하지 않지만 커널 모드의 소프트웨어가 응용 프로그램을 정리할 수 있도록 커널 모드로 전환합니다. 

 응용 프로그램은 사용자 모드 명령(예: 숫자 추가 등)만 실행할 수 있으며 사용자 공간에서 실행되는 반면 커널 모드의 소프트웨어는 권한 있는 명령도 실행할 수 있으며 커널 공간에서 실행된다고 합니다. 

* 커널 공간(또는 커널 모드)에서 실행되는 소프트웨어를 커널이라고 합니다.

##### 커널 전환 (interrupt)

사용자 모드 응용 프로그램이 디스크를 읽거나 써야 하는 경우 응용 프로그램 자체에서 I/O 명령을 실행할 수 없기 때문에 이를 수행하기 위해 커널로 전환해야 합니다. 프로세서는 프로세서를 사용자 모드에서 커널 모드로 전환하고 커널이 지정한 진입점에서 커널로 들어가는 특수 명령을 제공합니다. (x86 프로세서는 이 목적을 위해 int 명령어를 제공합니다.) 



프로세서가 커널 모드로 전환되면 커널은 시스템 호출의 인수를 확인하고 애플리케이션이 요청된 작업을 수행하도록 허용할지 여부를 결정한 다음 거부할 수 있습니다. 

커널 모드로 전환할 때 커널이 진입점을 설정하는 것이 중요합니다. 응용 프로그램이 커널 진입점을 결정할 수 있다면 악성 응용 프로그램은 인수 등의 유효성 검사를 건너뛰는 지점에서 커널에 진입할 수 있습니다.