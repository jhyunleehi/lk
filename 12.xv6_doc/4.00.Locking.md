## Locking

####  the lock protects the data structure.

* lock을 이용해서 kernel 데이터 구조를 보호한다.

Xv6은 코드를 독립적으로 실행하는 다중 CPU가 있는 컴퓨터인 다중 프로세서에서 실행됩니다.

* 다중 CPU는 단일 물리적 주소 공간에서 작동하고 데이터 구조를 공유합니다. xv6은 서로 간섭하지 않도록 조정 메커니즘을 도입해야 합니다.

* 단일 프로세서에서도 xv6은 인터럽트 처리기가 비 인터럽트 코드를 방해하지 않도록 하는 몇 가지 메커니즘을 사용해야 합니다.

Xv6은 잠금이라는 두 가지 모두에 대해 동일한 저수준 개념을 사용합니다.

* 잠금은 상호 배제를 제공하여 한 번에 하나의 CPU만 잠금을 보유할 수 있도록 합니다. 

xv6이 특정 잠금을 유지하는 동안에만 데이터 구조에 액세스하는 경우 xv6은 한 번에 하나의 CPU만 데이터 구조에 액세스하고 있음을 확인할 수 있습니다. 이 상황에서 우리는 잠금이 데이터 구조를 보호한다고 말합니다.

이 장의 나머지 부분에서는 xv6에 잠금이 필요한 이유, xv6이 잠금을 구현하는 방법, 잠금을 사용하는 방법에 대해 설명합니다.

##### 다른 프로세서가 데이터를 변경할 수 있다는 것

* 다른 프로세서서 의도한 동작을 변경 시킬수 있다는 것을 의심해야 한다.
* 단일 C 언어 구문도 원자적으로 실행될 것을 보장할 수 없다.

중요한 관찰은 xv6의 코드 라인을 보면 라인의 의도된 동작을 변경할 수 있는 다른 프로세서가 있는지 스스로에게 물어봐야 한다는 것입니다(예: 다른 프로세서도 해당 라인이나 다른 라인을 실행하고 있기 때문에). 공유 변수를 수정하는 코드) 및 인터럽트 핸들러가 실행되면 어떻게 될지.

두 경우 모두, 하나의 C 문이 여러 기계 명령어가 될 수 있으므로 다른 프로세서나 인터럽트가 C 문 중간에서 엉망이 될 수 있음을 명심해야 합니다.

페이지의 코드 행이 순차적으로 실행된다고 가정할 수 없으며 단일 C 문이 원자적으로 실행될 것이라고 가정할 수도 없습니다. 동시성은 정확성에 대한 추론을 훨씬 더 어렵게 만듭니다.