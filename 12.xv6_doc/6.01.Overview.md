## 개요

xv6 파일 시스템 구현은 그림 6-1과 같이 7개의 계층으로 구성됩니다.

* 디스크 계층은 IDE 하드 드라이브에서 블록을 읽고 씁니다.

* 버퍼 캐시 계층은 디스크 블록을 캐시하고 액세스를 동기화하여 한 번에 하나의 커널 프로세스만 특정 블록에 저장된 데이터를 수정할 수 있도록 합니다.
* 로깅 계층을 사용하면 상위 계층에서 트랜잭션의 여러 블록에 대한 업데이트를 래핑할 수 있으며  블록이 원자적으로 업데이트되도록 합니다(즉, 모든 블록이 업데이트되거나 업데이트되지 않음).
* inode 계층은 개별 파일을 제공하며, 각각은 고유한 i-번호와 파일 데이터를 보유하는 일부 블록이 있는 inode로 표시됩니다.
* 디렉토리 계층은 각 디렉토리를 파일 이름과 i-번호가 포함된 디렉토리 항목의 시퀀스인 내용을 가진 특별한 종류의 inode로 구현합니다.
* 경로 이름 계층은 /usr/rtm/xv6/fs.c와 같은 계층적 경로 이름을 제공하고 재귀 조회로 확인합니다.
* 파일 설명자 계층은 파일 시스템 인터페이스를 사용하여 많은 Unix 리소스(예: 파이프, 장치, 파일 등)를 추상화하여 응용 프로그램 프로그래머의 삶을 단순화합니다.

![image-20220220234034563](img/image-20220220234034563.png)

파일 시스템에는 디스크에서 inode와 콘텐츠 블록을 저장할 위치를 결정한다. 

xv6은 그림 6-2와 같이 디스크를 여러 섹션으로 나눕니다.

![image-20220220234120669](img/image-20220220234120669.png)

파일 시스템은 블록 0(부트 섹터를 보유함)을 사용하지 않습니다. 

* 슈퍼블록:  여기에는 파일 시스템에 대한 메타데이터(블록 단위 파일 시스템 크기, 데이터 블록 수, inode 수 및 로그의 블록 수)가 포함됩니다.
* Inode:  2에서 시작하는 블록은 블록당 여러 개의 inode가 있는 inode를 보유합니다.
* 비트맵:  블럭  그 다음에는 사용 중인 데이터 블록을 추적하는 비트맵 블록이 나옵니다. 
* 데이터 블럭: 나머지 블록의 대부분은 데이터 블록입니다. 각각은 비트맵 블록에서 사용 가능으로 표시되거나 파일 또는 디렉토리에 대한 내용을 보유합니다. 디스크 끝에 있는 블록은 로깅 계층의 로그를 보유합니다.

이 장의 나머지 부분에서는 버퍼 캐시부터 시작하여 각 계층에 대해 설명합니다. 

