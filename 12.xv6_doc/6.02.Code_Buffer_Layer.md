## buffer cache layer

버퍼 캐시는 두가지 역할을 한다.

* 하나의 디스크 블럭만 모리에 있게하고, 하나의 커널 스레드만 그 복사본에  접근할 수 있도록 동기화된 디스크 엑세스를 하게 한다. 
* buffer cache는 자주 사용하는 디스크 블럭을 캐쉬한다. 그래서 디스크에서 다시 읽지 않아도 된다.

bio.c 파일에서 구현되어 있다.

주요 인터페이스는 bread와 bwrite 이다. bread는 메모리에서 읽거나 수정할 수 있는 buffer cache를 얻어 내는 것이고, bwrite는 수정된 버퍼 cache의 내용을 디스크에 기록한다. 

buffer cache는 최대 하나의 커널 스레드만 block buffer만 참조하도록 허용하는 방법을 이용하도록 하여 동기화된 access를 하도록 한다.

한 커널 스레드가 버퍼에 대한 참조를 하고 있는 상태에서 해제를 하지 않는다면, 동일 한 버퍼를 참조하기 위한 쓰레드의 호출은 대기 해야 한다. 

상위 계층의 파일 시스템은 그들의 불변성을 유지하기 위해서 buffer cache 블럭 동기화 방법에 의존한다. 즉 buffer cache sychronization 방법을 이용한다.



buffer cache는 디스크 블럭을 저장할 수 있는 고정된 크기의 buffers를 가지고 있다.   이것은 무슨 뜻이냐면, 파일 시스템에서 버퍼 캐시에 없는 디스크 브럭을 요청할때, 버퍼 캐시는 현재 다른 블럭을 가지고 있는 버퍼를 재활용해야 한다는 뜻이다.  버퍼 캐시는 새블록에 대해서 가장 최근에 사용된 버퍼를 재활용 한다. 



이것은 가장 최근에 사용된 버퍼가 곧 다시 사용될 가능성이 가장 낮은 버퍼라고 가정한다. 

