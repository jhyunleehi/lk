## Kernel organization

### 커널의 구조

운영 체제에 대한 주요 설계 질문은 운영 체제의 어느 부분이 커널 모드에서 실행되어야 하는지입니다.

##### 모놀리식 커널

 간단한 대답은 커널 인터페이스가 시스템 호출 인터페이스라는 것입니다. 즉, fork, exec, open, close, read, write 등은 모두 system call 입니다. 이것은 trap을 의미한다. 
이 선택은 운영 체제의 완전한 구현이 커널 모드에서 실행됨을 의미합니다. 이 커널 조직을 모놀리식 커널이라고 합니다.

이 구조에서 전체 운영 체제는 전체 하드웨어 권한으로 실행됩니다.

이 구성은 OS 디자이너가 전체 하드웨어 권한이 필요하지 않은 운영 체제 부분을 결정할 필요가 없기 때문에 편리합니다. 또한 운영 체제의 여러 부분이 쉽게 협력할 수 있습니다. 예를 들어, 운영 체제에는 파일 시스템과 가상 메모리 시스템 모두에서 공유할 수 있는 버퍼 캐시가 있을 수 있습니다.

모놀리식 조직의 단점은 운영 체제의 다른 부분 간의 인터페이스가 종종 복잡하고(이 텍스트의 나머지 부분에서 볼 수 있듯이) 운영 체제 개발자가 실수하기 쉽다는 것입니다. 모놀리식 커널에서는 커널 모드의 오류로 인해 커널이 실패하는 경우가 많기 때문에 실수는 치명적입니다. 커널이 실패하면 컴퓨터가 작동을 멈추고 모든 응용 프로그램도 실패합니다. 다시 시작하려면 컴퓨터를 재부팅해야 합니다.

##### 마이크로 커널

커널의 실수 위험을 줄이기 위해 OS 디자이너는 커널 모드에서 실행되는 코드 라인을 작게 만들 수 있습니다. 대부분의 운영 체제는 권한 있는 명령에 액세스할 필요가 없으므로 일반 사용자 수준 응용 프로그램으로 실행할 수 있습니다.
메시지를 통해 상호 작용하는 응용 프로그램. 이 커널 조직을 마이크로커널이라고 합니다.
그림 1-1은 이 마이크로커널 디자인을 보여줍니다. 그림에서 파일 시스템은 사용자 수준 응용 프로그램으로 실행됩니다. 일반 사용자 프로그램으로 실행되는 서비스를 제공하는 운영 체제를 서버라고 합니다. 

응용 프로그램이 파일 서버와 상호 작용할 수 있도록 커널은 한 사용자 모드 응용 프로그램에서 다른 사용자 모드 응용 프로그램으로 메시지를 보내는 최소한의 메커니즘을 제공합니다. 예를 들어 쉘과 같은 응용 프로그램이 파일을 읽거나 쓰려면 파일 서버에 메시지를 보내고 응답을 기다립니다.

마이크로커널에서 커널 인터페이스는 애플리케이션 시작, I/O 수행, 애플리케이션에 메시지 전송 등을 위한 몇 가지 저수준 기능으로 구성됩니다. 이 구성을 통해 몇 줄의 코드로 커널을 구현할 수 있습니다. 운영 체제의 대부분의 기능이 사용자 수준 서버에 의해 구현되기 때문에 많은 일을 할 수 있습니다.
실제 세계에서는 모놀리식 커널과 마이크로 커널을 모두 찾을 수 있습니다. 예를 들어,
일부 OS 기능은 사용자 수준 서버(예: 윈도우 시스템)로 실행되지만 Linux는 대부분 모놀리식 커널로 구현됩니다. 

Xv6은 대부분의 Unix 운영 체제를 따르는 모놀리식 커널로 구현됩니다. 따라서 xv6에서 커널 인터페이스는 운영 체제 인터페이스에 해당하고 커널은 완전한 운영 체제를 구현합니다. xv6은 많은 기능을 제공하지 않기 때문에 커널은 일부 마이크로 커널보다 작습니다.